<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css">

























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="一只西雅图的程序员">
<meta name="keywords" content="sourberrycat, 酸梅猫">
<meta property="og:type" content="website">
<meta property="og:title" content="酸梅猫的博客">
<meta property="og:url" content="http://sourberrycat.com/index.html">
<meta property="og:site_name" content="酸梅猫的博客">
<meta property="og:description" content="一只西雅图的程序员">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="酸梅猫的博客">
<meta name="twitter:description" content="一只西雅图的程序员">






  <link rel="canonical" href="http://sourberrycat.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>酸梅猫的博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">酸梅猫的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sourberrycat.com/reading/non-blocking-io/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="酸梅猫">
      <meta itemprop="description" content="一只西雅图的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酸梅猫的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/reading/non-blocking-io/" class="post-title-link" itemprop="url">阻断与非阻断I/O</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-08-11 23:02:30 / 修改时间：07:25:16" itemprop="dateCreated datePublished" datetime="2020-08-11T23:02:30Z">2020-08-11</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/工作原理/" itemprop="url" rel="index"><span itemprop="name">工作原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="I-O-基础"><a href="#I-O-基础" class="headerlink" title="I/O 基础"></a>I/O 基础</h2><p>简单介绍一下I/O的基本工作方式</p>
<ol>
<li>你的程序通过“syscall()”请求操作系统的内核去做一个I/O操作。</li>
<li>一个”syscall()”是阻断的，你的程序需要等待内核返回才能继续执行你的代码。</li>
<li>内核执行底层的I/O操作，大多在硬件层面，执行时间根据的硬件的速度而变化。</li>
</ol>
<img src="/reading/non-blocking-io/syscall.png" title="Syscall">
<h2 id="阻断型I-O"><a href="#阻断型I-O" class="headerlink" title="阻断型I/O"></a>阻断型I/O</h2><p>大多语言，比如说Java，Python的I/O调用的阻断型的，你的程序需要等待I/O返回之后才能继续后面的工作。当有高并发的需求的时候，大量的线程需要进行大量的上下文切换。就会导致浪费大量CPU资源。</p>
<h2 id="非阻断型I-O"><a href="#非阻断型I-O" class="headerlink" title="非阻断型I/O"></a>非阻断型I/O</h2><p>Nodejs的独特的事件循环使得他可以方便的运行非阻断型I/O。每一个I/O请求都会作为一个消息发送在事件循环中，Nodejs会继续执行其他代码直到这个I/O请求结束之后通过callback返回结果。</p>
<p>由于这个独特的设计是的Nodejs在处理高并发，I/O为主的程序中发挥极大的功效。当传统的网络服务器(线程型)能处理4000并发的时候，Nodejs可以处理1百万并发，和大约60万并发websockets的连接。</p>
<p>但是由于Nodejs基于V8单线程的原因，他不适合处理高运算量的代码，一个高运算量的循环就可以使得整个程序瘫痪。</p>
<p>基于Nodejs的这些特性，以下是一些比较适合他的应用场景：</p>
<ul>
<li>聊天软件</li>
<li>读写NoSQL数据库的API(MongoDB)</li>
<li>队列/消息请求</li>
<li>数据流</li>
<li>代理(Proxy)</li>
</ul>
<p>更多阅读：<br><a href="https://medium.com/the-node-js-collection/why-the-hell-would-you-use-node-js-4b053b94ab8e" target="_blank" rel="noopener">Why the Hell Would You Use Node.js
</a><br><a href="https://www.toptal.com/back-end/server-side-io-performance-node-php-java-go" target="_blank" rel="noopener">Server-side I/O Performance: Node vs. PHP vs. Java vs. Go</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sourberrycat.com/reading/process-thread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="酸梅猫">
      <meta itemprop="description" content="一只西雅图的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酸梅猫的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/reading/process-thread/" class="post-title-link" itemprop="url">进程，线程和协程</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-08-11 21:02:30 / 修改时间：07:25:09" itemprop="dateCreated datePublished" datetime="2020-08-11T21:02:30Z">2020-08-11</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/工作原理/" itemprop="url" rel="index"><span itemprop="name">工作原理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="进程-process"><a href="#进程-process" class="headerlink" title="进程(process)"></a>进程(process)</h2><p>进程拥有独立的内存，寻址空间和寄存器。进程是直接被内核(kernel)管理的，一般每一个程序都拥有自己的线程。他们相互独立确保不会干扰彼此的工作。</p>
<p>在一个多进程的计算机中，一个CPU需要同时运行多个进。这是通过中断当前进程，然后保存当前进程中的内存，寄存器，PC(program counter), 变量表等，然后让下一个进程来运行，我们称之为上下文切换(context switch)。上下文切换是相对消耗运算量的，尤其是有很多进程并发的时候，频繁的上下文切换将会占用大量的CPU资源。</p>
<h2 id="线程-thread"><a href="#线程-thread" class="headerlink" title="线程(thread)"></a>线程(thread)</h2><p>线程是一种轻量级进程，线程直接可以共享内存，但执行不同的代码，所以各自有自己的栈内存和寄存器等。</p>
<p>线程一般由应用软件来创建，线程之间的上下文切换也是类似于进程，唯一的区别是会保留虚拟内存。</p>
<h2 id="协程-coroutine-goroutine"><a href="#协程-coroutine-goroutine" class="headerlink" title="协程(coroutine/goroutine)"></a>协程(coroutine/goroutine)</h2><p>进程和线程都是内核(kernel)级别的中断和上下文切换。他们都有在大量多线程/进程的情况中消耗CPU资源的问题。</p>
<p>协程将内核级别的上下文切换转换到了应用程序内。这样做的好处的通过应用程序的协调，避免的大量的内核上下文切换。而且很多协程中都使用自愿退出的模式，避免的大量的需要上下文切换的情况。</p>
<p>例如：RxJava, Kotlin coroutines, Go(goroutines)</p>
<p>更多阅读：<br><a href="https://medium.com/traveloka-engineering/cooperative-vs-preemptive-a-quest-to-maximize-concurrency-power-3b10c5a920fe" target="_blank" rel="noopener">Cooperative vs. Preemptive: a quest to maximize concurrency power</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sourberrycat.com/elastic-search/elastic-search-learnings/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="酸梅猫">
      <meta itemprop="description" content="一只西雅图的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酸梅猫的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/elastic-search/elastic-search-learnings/" class="post-title-link" itemprop="url">Elastic Search 搜索</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-05-09 19:36:44 / 修改时间：10:28:47" itemprop="dateCreated datePublished" datetime="2020-05-09T19:36:44Z">2020-05-09</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/学习笔记/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="如何搜索"><a href="#如何搜索" class="headerlink" title="如何搜索"></a>如何搜索</h2><p>这里我们会尽量用java作为例子来解释如何使用ElasticSearch。<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high-search.html" target="_blank" rel="noopener">ES HighLevel REST Client</a></p>
<h3 id="BoolQuery-的用法与特性"><a href="#BoolQuery-的用法与特性" class="headerlink" title="BoolQuery 的用法与特性"></a>BoolQuery 的用法与特性</h3><p>BoolQuery 作为一个主要的Query结构一般用于整个Query的根。Query的结果会根据score默认排序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">searchSourceBuilder.query(QueryBuilders.boolQueryBuilder()); </span><br><span class="line">searchRequest.source(searchSourceBuilder);</span><br></pre></td></tr></table></figure>
<p>BoolQuery 拥有4个不同的Query类型。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 必须匹配，匹配会增加score。MatchQuery 这里表示"名字"必须包含“大卫”或者“David”其中一个, 多个匹配会增加其结果的score。</span></span><br><span class="line">boolQueryBuilder.must(QueryBuilders.matchQuery(<span class="string">"名字"</span>, <span class="string">"大卫 David"</span>)) </span><br><span class="line"><span class="comment">// 每一个query类型都可以添加多个子Query，其关系是“AND”。并且可以是BoolQuery</span></span><br><span class="line">boolQueryBuilder.must(QueryBuilders.boolQuery()) </span><br><span class="line"><span class="comment">// 必须匹配，匹配不影响score。TermsQuery 这里表示"id"必须等于“123”或者“321”</span></span><br><span class="line">boolQueryBuilder.filter(QueryBuilders.termsQuery(<span class="string">"id"</span>, <span class="string">"123"</span>， <span class="string">"321"</span>))</span><br><span class="line"><span class="comment">// 非必须匹配，匹配增加score。</span></span><br><span class="line">boolQueryBuilder.should()</span><br><span class="line"><span class="comment">// 设定最少匹配“should”的数量，如果没有规定“must”/“filter”默认值是1，有的话默认值是0</span></span><br><span class="line">boolQueryBuilder.minimalShouldMatch(<span class="number">1</span>) </span><br><span class="line"><span class="comment">// 必须不包含，不影响score。</span></span><br><span class="line">boolQueryBuilder.must_not()</span><br></pre></td></tr></table></figure></p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/elastic-search/elastic-search-learnings/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sourberrycat.com/clean-architecture/clean-architecture-part11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="酸梅猫">
      <meta itemprop="description" content="一只西雅图的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酸梅猫的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/clean-architecture/clean-architecture-part11/" class="post-title-link" itemprop="url">测试的设计 - Clean Architecture Part 11</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-06 12:34:05" itemprop="dateCreated datePublished" datetime="2019-04-06T12:34:05Z">2019-04-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-05-09 03:45:46" itemprop="dateModified" datetime="2020-05-09T03:45:46Z">2020-05-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/" itemprop="url" rel="index"><span itemprop="name">读书</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/Clean-Architecture/" itemprop="url" rel="index"><span itemprop="name">Clean Architecture</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="把测试当作系统模块"><a href="#把测试当作系统模块" class="headerlink" title="把测试当作系统模块"></a>把测试当作系统模块</h2><p>大多人在设计系统的时候经常犯一个错误，没有把测试作为一个模块设计到系统中。</p>
<p>未经设计的测试会使系统变得难以改变。经常一个很小大改动，或者重构，就会使得很多测试失败。</p>
<p>优良的测试不会使得系统的开发和进化受到限制。它会作为系统的一个独立的模块而存在。它也应该具有模块的界限，解耦和依赖倒置。</p>
<h2 id="测试API"><a href="#测试API" class="headerlink" title="测试API"></a>测试API</h2><p>实现以上方案的一个技巧是，给测试模块提供专用的API。</p>
<ul>
<li><p>减少测试时的各种配置的设置，例如提供一个不需要登陆的API，提供一个不使用云数据库的API。这样测试可以与这些配置解耦，更容易去测试核心逻辑。</p>
</li>
<li><p>减少结构上的耦合。很多情况下，大家写测试都是一一对应的。例如在写单元测试的时候，将系统的类和方法与测试中的类与方法一一对应。这样的测试具有极强的耦合，导致难以修改和扩展。但是当我们应用测试API时，将一组类或方法所提供的功能，总结为一个API。这样，测试就和系统解耦了。测试只关心功能的正确性，而不关心实现的细节。</p>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sourberrycat.com/clean-architecture/clean-architecture-part10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="酸梅猫">
      <meta itemprop="description" content="一只西雅图的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酸梅猫的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/clean-architecture/clean-architecture-part10/" class="post-title-link" itemprop="url">难测对象模式 - Clean Architecture Part 10</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-04 20:31:30" itemprop="dateCreated datePublished" datetime="2019-04-04T20:31:30Z">2019-04-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-05-09 03:49:18" itemprop="dateModified" datetime="2020-05-09T03:49:18Z">2020-05-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/" itemprop="url" rel="index"><span itemprop="name">读书</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/Clean-Architecture/" itemprop="url" rel="index"><span itemprop="name">Clean Architecture</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="展示者和难测对象模式（Presenters-and-Humble-Objects）"><a href="#展示者和难测对象模式（Presenters-and-Humble-Objects）" class="headerlink" title="展示者和难测对象模式（Presenters and Humble Objects）"></a>展示者和难测对象模式（Presenters and Humble Objects）</h2><p>将系统中难以测试的部分取出来，而使得其他逻辑易于测试。</p>
<p>例如说，UI就是难以测试的部分，而展示者（Presenters）则把系统中心的数据转化为UI可以直接用来现实的格式。这样我们就可以通过测试展示者来测试系统的行为。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Application –&gt; Presenter –&gt; ViewModel –&gt; View</span><br></pre></td></tr></table></figure>
<h2 id="Data-Access-Object（DAO）"><a href="#Data-Access-Object（DAO）" class="headerlink" title="Data Access Object（DAO）"></a>Data Access Object（DAO）</h2><p>DAO是一个包含所有业务逻辑所需数据读写方法的接口。这个接口将被用例使用，而由数据库的模块implement。</p>
<h2 id="服务Proxy"><a href="#服务Proxy" class="headerlink" title="服务Proxy"></a>服务Proxy</h2><p>当你的系统需要使用其他网络服务的时候，最好的方法是创建一个Proxy的类来隔离耦合。这个Proxy的类会将系统提供的数据转化为其他网络服务接受的数据格式。这样我们就可以直接mock这个Proxy的类来进行测试了。</p>
<h2 id="部分隔离"><a href="#部分隔离" class="headerlink" title="部分隔离"></a>部分隔离</h2><p>在很多情况下严格执行界限分离的构架非常的昂贵。</p>
<ul>
<li>严格的界限分离需要多写很多代码</li>
<li>需要额外的工作去部署</li>
<li>你有可能并不需要分离这部分的模块</li>
</ul>
<ul>
<li>你可以使用部分隔离的方法，按照界限分离的方式开发，但是只放在同一个模块中。</li>
<li>Strategy Pattern<br><img src="/clean-architecture/clean-architecture-part10/sp.png" width="500" height="300" title="Strategy Pattern"></li>
<li>Facade Pattern<br><img src="/clean-architecture/clean-architecture-part10/fp.png" width="500" height="300" title="Facade Pattern"></li>
</ul>
<h2 id="入口程序模块（The-Main-Component）"><a href="#入口程序模块（The-Main-Component）" class="headerlink" title="入口程序模块（The Main Component）"></a>入口程序模块（The Main Component）</h2><ul>
<li>入口程序依赖于所有的部分，它知道所有模块的存在。</li>
<li>最细节的模块，需要创建所有的工厂类，模块等。</li>
<li>为高级系统加载所有内容，然后将控制权交给它。</li>
<li>当你把入口程序作为整个构架之外的插件来看待的话，系统配置的问题就会容易解决。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sourberrycat.com/clean-architecture/clean-architecture-part9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="酸梅猫">
      <meta itemprop="description" content="一只西雅图的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酸梅猫的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/clean-architecture/clean-architecture-part9/" class="post-title-link" itemprop="url">干净的构架 - Clean Architecture Part 9</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-03 21:02:39" itemprop="dateCreated datePublished" datetime="2019-04-03T21:02:39Z">2019-04-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-05-09 03:49:08" itemprop="dateModified" datetime="2020-05-09T03:49:08Z">2020-05-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/" itemprop="url" rel="index"><span itemprop="name">读书</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/Clean-Architecture/" itemprop="url" rel="index"><span itemprop="name">Clean Architecture</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>这篇我们将介绍这本书最核心的概念 - 干净构架。</p>
<p>首先一个干净的构架应该拥有以下几点特征：</p>
<ul>
<li>不依赖于任何框架，数据库，UI，服务器</li>
<li>在没有UI，数据库，服务器的情况下可以测试</li>
</ul>
<p><img src="/clean-architecture/clean-architecture-part9/clean-architecture.png" width="500" height="300" title="CleanArchitecture"></p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/clean-architecture/clean-architecture-part9/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sourberrycat.com/clean-architecture/clean-architecture-part8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="酸梅猫">
      <meta itemprop="description" content="一只西雅图的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酸梅猫的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/clean-architecture/clean-architecture-part8/" class="post-title-link" itemprop="url">实体与用例 - Clean Architecture Part 8</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-01 21:26:33" itemprop="dateCreated datePublished" datetime="2019-04-01T21:26:33Z">2019-04-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-05-09 03:45:46" itemprop="dateModified" datetime="2020-05-09T03:45:46Z">2020-05-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/" itemprop="url" rel="index"><span itemprop="name">读书</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/Clean-Architecture/" itemprop="url" rel="index"><span itemprop="name">Clean Architecture</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <ul>
<li><p>规则指的就是一个软件的业务逻辑，也是它的价值所在。</p>
</li>
<li><p>等级我们可以理解为模块到输入和输出的距离，距离越远模块等级越高。</p>
</li>
<li><p>业务逻辑，就是可以使一个业务赚钱或者省钱的逻辑。</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/clean-architecture/clean-architecture-part8/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </li></ul></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sourberrycat.com/clean-architecture/clean-architecture-part7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="酸梅猫">
      <meta itemprop="description" content="一只西雅图的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酸梅猫的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/clean-architecture/clean-architecture-part7/" class="post-title-link" itemprop="url">界限：插件构架 - Clean Architecture Part 7</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-31 20:13:23" itemprop="dateCreated datePublished" datetime="2019-03-31T20:13:23Z">2019-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-05-09 03:48:52" itemprop="dateModified" datetime="2020-05-09T03:48:52Z">2020-05-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/" itemprop="url" rel="index"><span itemprop="name">读书</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/Clean-Architecture/" itemprop="url" rel="index"><span itemprop="name">Clean Architecture</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>构架的关键是解耦，尤其是对一些“重要”决定的解耦。在软件开发初期，经常会有一些看似很重要但是与业务逻辑其实没有关系的决定，例如框架，数据库，服务器等。一个优秀的系统是不会依赖于这些决定的。</p>
<p>我们要对这些于业务逻辑无关的“重要”决定划清界限。</p>
<p>例如：</p>
<p><img src="/clean-architecture/clean-architecture-part7/plug-in.png" width="500" height="300" title="界限"><br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/clean-architecture/clean-architecture-part7/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sourberrycat.com/clean-architecture/clean-architecture-part6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="酸梅猫">
      <meta itemprop="description" content="一只西雅图的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酸梅猫的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/clean-architecture/clean-architecture-part6/" class="post-title-link" itemprop="url">解耦 - Clean Architecture Part 6</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-31 17:04:02" itemprop="dateCreated datePublished" datetime="2019-03-31T17:04:02Z">2019-03-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-05-09 03:45:46" itemprop="dateModified" datetime="2020-05-09T03:45:46Z">2020-05-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/" itemprop="url" rel="index"><span itemprop="name">读书</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/Clean-Architecture/" itemprop="url" rel="index"><span itemprop="name">Clean Architecture</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>其实很多人都知道软件构架和开发过程中的核心思想就是解耦。解耦的核心就是将需要以不同的原因而修改的部分分开。</p>
<h2 id="水平解耦"><a href="#水平解耦" class="headerlink" title="水平解耦"></a>水平解耦</h2><p>将用户界面，数据库，业务逻辑，服务框架等元素解耦，因为不同层次的结构所改变的原因并不一致。例如，用户界面的修改不应该导致数据库的修改，同样，数据库的修改也不应该影响用户界面。<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/clean-architecture/clean-architecture-part6/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sourberrycat.com/clean-architecture/clean-architecture-part5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="酸梅猫">
      <meta itemprop="description" content="一只西雅图的程序员">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酸梅猫的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                
                <a href="/clean-architecture/clean-architecture-part5/" class="post-title-link" itemprop="url">软件构架 - Clean Architecture Part 5</a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-03-24 15:41:33" itemprop="dateCreated datePublished" datetime="2019-03-24T15:41:33Z">2019-03-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-05-09 03:45:46" itemprop="dateModified" datetime="2020-05-09T03:45:46Z">2020-05-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/" itemprop="url" rel="index"><span itemprop="name">读书</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/读书/Clean-Architecture/" itemprop="url" rel="index"><span itemprop="name">Clean Architecture</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="什么是软件构架？"><a href="#什么是软件构架？" class="headerlink" title="什么是软件构架？"></a>什么是软件构架？</h2><p>传统物理工程的构架，构架师们只需要将这个工程从框架到细节设计出来，然后由工人施工，产品就完成了。<br>而软件与硬件最大的不同是, 软件需要持续的开发，修改Bug， 添加新功能，调整已有的功能等。<br>所以说软件的构架并不仅仅是设计满足功能需求的软件，更重要的是为其后续的生命周期中的<br><strong>开发</strong>，<strong>维护</strong>，<strong>发布</strong>以及<strong>扩展</strong>提供保障。<br>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/clean-architecture/clean-architecture-part5/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </p></div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">酸梅猫</p>
              <div class="site-description motion-element" itemprop="description">一只西雅图的程序员</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">16</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">酸梅猫</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
























  



  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-reading-progress@1/reading_progress.min.js"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.1"></script>




  

  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  
  <script src="/js/src/js.cookie.js?v=7.0.1"></script>
  <script src="/js/src/scroll-cookie.js?v=7.0.1"></script>


  

  

  



  



  
  
  
    
  
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css">

  
  
    
  
  <script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.js"></script>
  

  <script src="/js/src/algolia-search.js?v=7.0.1"></script>



  

  
  <script src="https://www.gstatic.com/firebasejs/4.6.0/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/4.6.0/firebase-firestore.js"></script>
  
  <script>
    (function () {

      firebase.initializeApp({
        apiKey: 'AIzaSyBq8kvairUAht2SRGKslPMvLJZwfPYGAU0',
        projectId: 'sourberrycat-blog'
      })

      function getCount(doc, increaseCount) {
        //increaseCount will be false when not in article page

        return doc.get().then(function (d) {
          var count
          if (!d.exists) { //has no data, initialize count
            if (increaseCount) {
              doc.set({
                count: 1
              })
              count = 1
            }
            else {
              count = 0
            }
          }
          else { //has data
            count = d.data().count
            if (increaseCount) {
              if (!(window.localStorage && window.localStorage.getItem(title))) { //if first view this article
                doc.set({ //increase count
                  count: count + 1
                })
                count++
              }
            }
          }
          if (window.localStorage && increaseCount) { //mark as visited
            localStorage.setItem(title, true)
          }

          return count
        })
      }

      function appendCountTo(el) {
        return function (count) {
          $(el).append(
            $('<span>').addClass('post-visitors-count').append(
              $('<span>').addClass('post-meta-divider').text('|')
            ).append(
              $('<span>').addClass('post-meta-item-icon').append(
                $('<i>').addClass('fa fa-users')
              )
              ).append($('<span>').text('阅读次数 ' + count))
          )
        }
      }

      var db = firebase.firestore()
      var articles = db.collection('articles')

      //https://hexo.io/docs/variables.html
      var isPost = ''.length > 0
      var isArchive = '' === 'true'
      var isCategory = ''.length > 0
      var isTag = ''.length > 0

      if (isPost) { //is article page
        var title = ''
        var doc = articles.doc(title)

        getCount(doc, true).then(appendCountTo($('.post-meta')))
      }
      else if (!isArchive && !isCategory && !isTag) { //is index page
        var titles = [] //array to titles

        var postsstr = 'titles.push("阻断与非阻断I/O");titles.push("进程，线程和协程");titles.push("Elastic Search 搜索");titles.push("测试的设计 - Clean Architecture Part 11");titles.push("难测对象模式 - Clean Architecture Part 10");titles.push("干净的构架 - Clean Architecture Part 9");titles.push("实体与用例 - Clean Architecture Part 8");titles.push("界限：插件构架 - Clean Architecture Part 7");titles.push("解耦 - Clean Architecture Part 6");titles.push("软件构架 - Clean Architecture Part 5");' //if you have a better way to get titles of posts, please change it
        eval(postsstr)

        var promises = titles.map(function (title) {
          return articles.doc(title)
        }).map(function (doc) {
          return getCount(doc)
        })
        Promise.all(promises).then(function (counts) {
          var metas = $('.post-meta')
          counts.forEach(function (val, idx) {
            appendCountTo(metas[idx])(val)
          })
        })
      }
    })()
  </script>


  

  

  

  

  

  
  
  
    
  
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script>
  <script>
    
      pbOptions = {};
      
        pbOptions.iconStyle = "box";
      
        pbOptions.boxForm = "horizontal";
      
        pbOptions.position = "bottomCenter";
      
        pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>


  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
